# Siry AI Research - 项目需求文档

## 1. 项目背景

### 1.1 项目愿景
**让消费者参与到企业决策中来** —— 通过AI模拟真实消费者，帮助企业快速获取市场洞察。

### 1.2 目标用户
- **资源有限的创业公司**：预算紧张，无法负担传统市场调研
- **受限的研究团队**：人力有限，需要快速迭代验证
- **需要快速转向的市场研究人员**：时间紧迫，需要敏捷的调研方式

### 1.3 核心价值
- 降低市场调研门槛
- 加速产品验证周期
- 提供真实感的消费者洞察

---

## 2. 业务场景定义

本项目覆盖 **4个核心业务场景**，使用 **3种Agent框架** 分别实现：

| 场景 | 描述 | 采用框架 | 并发规模 |
|-----|------|---------|---------|
| 1对1受众访谈 | 深度访谈，多轮对话 | Claude Agent SDK | 单用户 |
| 问卷批量投放 | 向多受众收集问卷回答 | Agno | 100-500 |
| 焦点小组批量 | 多参与者群体讨论 | Agno | 100-200 |
| 受众生成流水线 | 从描述生成完整受众画像 | SmolaAgents | 批量生成 |

---

## 3. 场景详细需求

### 3.1 场景一：1对1受众访谈（Claude Agent SDK）

#### 功能需求
- 完整的访谈流程执行（开场 → SPIN问题 → 追问 → 收尾）
- 多轮对话上下文记忆
- MCP工具集成（网页搜索、记忆存储等）
- 访谈记录自动保存

#### 技术要求
- 基于 Claude Agent SDK 的 Agentic Loop
- 支持 Tool Use 扩展
- 对话历史管理

#### 输入/输出
- **输入**：受众画像数据、访谈主题、研究目标
- **输出**：完整的访谈记录、洞察提取

#### 参考实现
```
backhour_ai/services/audience_agent.py
- _build_system_prompt_fallback_static() 方法中的提示词结构
- 对话风格指南（真实性原则、情感表达、矛盾行为等）
```

---

### 3.2 场景二：问卷批量投放（Agno）

#### 功能需求
- 批量向多个受众投放问卷
- 每个受众独立回答问卷问题
- 支持100-500规模并发
- 结果聚合与分析

#### 技术要求
- 基于 Agno Teams + Workflows
- `Team.run_parallel()` 并行执行
- 真实数据库集成

#### 输入/输出
- **输入**：问卷定义、目标受众列表
- **输出**：各受众回答结果、统计分析

#### 参考实现
```
backhour_ai/api/main.py
- execute_survey_deployment() 问卷投放逻辑
- 批量状态更新机制
```

---

### 3.3 场景三：焦点小组批量（Agno）

#### 功能需求
- 多参与者群体讨论
- 主持人提问 → 多参与者并发回答
- 支持100-200个并发参与者
- 洞察自动提取

#### 技术要求
- Agno Teams 编排多Agent
- 并发控制与状态管理
- 异步任务 + 轮询模式（避免前端超时）

#### 输入/输出
- **输入**：焦点小组主题、参与者列表、主持人问题
- **输出**：各参与者回答、群体洞察

#### 参考实现
```
backhour_ai/api/focus_group_router.py
- batch_generate_participant_response() 批量生成逻辑
- 任务管理器模式（get_or_create_task）
- 引擎自动选择（>=3人使用并行模式）
```

---

### 3.4 场景四：受众生成流水线（SmolaAgents）

#### 功能需求
- 三步流水线：基础信息 → 人格特征 → 行为模式
- 支持灵活的流程编排
- Manager Agent协调多个专业Agent

#### 技术要求
- SmolaAgents Manager + Managed Agents 模式
- `@tool` 装饰器定义工具
- 流程可配置、可扩展

#### 输入/输出
- **输入**：受众描述、生成参数
- **输出**：完整受众画像（含人格、行为模式）

#### 参考实现
```
backhour_ai/services/audience_generator.py（如存在）
- 受众生成的三阶段逻辑
```

---

## 4. 非功能需求

### 4.1 性能要求
- 批量场景响应时间 < 3分钟（100个受众）
- 单次对话响应时间 < 10秒
- 并发支持：至少200个并发Agent

### 4.2 可靠性要求
- 任务失败重试机制
- 进度实时追踪
- 错误隔离（单个失败不影响整体）

### 4.3 可扩展性要求
- 支持新框架接入
- 支持新场景扩展
- 提示词模板化管理

---

## 5. 约束与假设

### 5.1 技术约束
- Python 3.10+
- 依赖外部LLM API（Claude、OpenAI、OpenRouter等）
- 暂不需要Web UI

### 5.2 业务约束
- 复用已有提示词，不重新造轮子
- 保持与 backhour_ai 的业务逻辑一致性

### 5.3 假设
- 用户已有 Anthropic API Key
- 受众数据来源于外部系统或手动输入
- 未来考虑接入 PageIndex 存储受众数据

---

## 6. 验收标准

### 6.1 场景一验收
- [ ] 完成一次完整的SPIN访谈流程
- [ ] 对话上下文正确维护
- [ ] MCP工具可正常调用

### 6.2 场景二验收
- [ ] 成功向100个受众批量投放问卷
- [ ] 各受众回答内容符合其画像特征
- [ ] 结果可正确聚合

### 6.3 场景三验收
- [ ] 主持人问题可推送给所有参与者
- [ ] 100个参与者并发回答无重复
- [ ] 洞察提取功能正常

### 6.4 场景四验收
- [ ] 三步流水线完整执行
- [ ] 生成的受众画像质量符合预期
- [ ] 流程可配置
